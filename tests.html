<!Doctype html>
<script type=module>
'use strict';
import {cherub} from './node_modules/cherub/cherub.js';
import {chant,chant2} from './chant.js';
import {util} from './chant.util.js';
const
tests={},
initalState={obj:{prop:'val'}},
setup=()=>chant2(initalState),
{test}=cherub;
tests.chant=
[
	test('get')
	.tests
	(
		test('()').func(setup).rtn(initalState),
		test('obj.prop').func(()=>util.clone(setup().obj.prop)).rtn('val')
	),
	test('delete')
	.func(function()
	{
		const state=setup();
		delete state.obj.prop;
		return state;
	})
	.rtn({obj:{}}),
	test('set')
	.func(function()
	{
		const state=setup();
		state.obj.prop='value';
		return state.obj.prop;
	})
	.rtn('value'),
	test('update')
	.func(function()
	{
		const state=setup();
		state.obj.prop+='.';
		return state.obj.prop;
	})
	.rtn('val.'),
	test('off')
	.func(function()
	{
		let
		state=setup(),
		sum=0,
		obj=
		{
			path:['obj','prop'],
			func:action=>sum+=1
		};
		state.on(obj);
		state.obj.prop='val2';
		state.obj.prop='val3';
		state.off(obj);
		state.obj.prop='val4';
		return sum;
	})
	.rtn(2)/*,
	test('on')
	.func(function()
	{
		let
		state=chant(initalState),
		sum=0,
		func=action=>sum+=1;
		state.on({path:'obj.prop',func});
		state.set('obj.prop','val2');
		state.set('obj.prop','val3');
		return sum;
	})
	.rtn(2),
	test('separator')
	.func(()=>chant(initalState,{separator:'/'}).get('obj/prop'))
	.rtn('val')*/
];
cherub({now:()=>performance.now()})
.run(
{
	name:'chant',
	tests:tests.chant
});
chant({greeting:'hi'}).with();
</script>