<!Doctype html>
<script type=module>
'use strict';
import {cherub} from './node_modules/cherub/cherub.js';
import {chant} from './chant.js';
const
tests={},
initalState={obj:{prop:'val'}},
args=
{
},
util=
{
	addperiod:txt=>(txt+'.')
},
rtn=
{
},
{test}=cherub;
tests.chant=
[
	{
		name:'get',
		func:arg=>chant(initalState).get(arg),
		tests:
		[
			{
				name:'()',
				rtn:initalState
			},
			{
				name:'(obj.prop)',
				args:['obj.prop'],
				rtn:'val'
			}
		]
	},
	{
		name:'delete',
		func:()=>chant(initalState).delete('obj.prop').get(),
		rtn:{obj:{}}
	},
	{
		name:'set',
		func:()=>chant(initalState).set('obj.prop','value').get('obj.prop'),
		rtn:'value'
	},
	{
		name:'update',
		func:()=>chant(initalState).update('obj.prop',util.addperiod).get('obj.prop'),
		rtn:'val.'
	},
	test('off').func(function()
	{
		let
		state=chant(initalState),
		sum=0,
		func=action=>sum+=1;
		state.on('obj.prop','',func);
		state.set('obj.prop','val2');
		state.set('obj.prop','val3');
		state.off('obj.prop','',func);
		state.set('obj.prop','val4');
		return sum;
	}).rtn(2),
	test('on').func(function()
	{
		let
		state=chant(initalState),
		sum=0,
		func=action=>sum+=1;
		state.on('obj.prop','',func);
		state.set('obj.prop','val2');
		state.set('obj.prop','val3');
		return sum;
	}).rtn(2)
];
cherub({now:()=>performance.now()})
.run(
{
	name:'chant',
	tests:tests.chant
});
</script>